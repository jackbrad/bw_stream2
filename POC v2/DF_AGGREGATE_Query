SELECT 
    CUSTOMER_ID,
    MESSAGE_STATUS,	
    RECORD_TYPE,
    DLR_CODE,
    PRODUCT,
    MESSAGE_DIRECTION ,
    COUNT(MDR_ID) as MESSAGE_COUNT,
    MESSAGE_DATE,	
    EXTRACT(HOUR FROM event_timestamp) as MESSAGE_HOUR,	
    EXTRACT(MINUTE FROM event_timestamp) as MESSAGE_MINUTE,	
    EXTRACT(HOUR FROM event_timestamp) as MESSAGE_DATE_HR_MIN,	

    CALLING_NUMBER,
    AMP_NAME,
    PROVIDER_NAME,	
    CALLED_NUMBER_COUNTRY,	
    event_timestamp as SOURCE_INSERT_TIMESTAMP,	
    event_timestamp as INSERT_TIMESTAMP,
    event_timestamp as UPDATE_TIMESTAMP,	
    CUSTOMER_NAME,
    CALLED_NUMBER_STATE,	
    BILLABLE
    
FROM pubsub.topic.patrickstarfish.IncomingV2
Group By 
    TUMBLE(event_timestamp, 'INTERVAL 1 MINUTE'),
    CUSTOMER_ID,
    MESSAGE_STATUS,	
    RECORD_TYPE,
    DLR_CODE,
    PRODUCT,
    MESSAGE_DIRECTION,	
    EXTRACT(HOUR FROM event_timestamp) as Hour,	
    EXTRACT(MINUTE FROM event_timestamp),	
    EXTRACT(HOUR FROM event_timestamp),	
    CALLING_NUMBER,
    AMP_NAME,
    PROVIDER_NAME,	
    CALLED_NUMBER_COUNTRY,
    CUSTOMER_NAME,	
    CALLED_NUMBER_STATE,	
    BILLABLE, 
    MESSAGE_DATE
   